---
title: "*easylca* model report report for `r params$easylca$settings$folder_name`"
date: "*created `r format(Sys.time(), '%H:%M, %B %d, %Y')`*"
output: 
  html_document:
    css: model_report_template.css
params:
  easylca: NULL
  modeltype: NULL
  classes: NULL
  show_significance: NULL
---

```{r data_unpacking, echo=F}
easylca <- params$easylca 
modeltype <- params$modeltype
classes <- params$classes
show_significance <- params$show_significance


model <- easylca$models[[paste0('modeltype_', modeltype)]][[classes]]
model_parameters <- get_profiles_for_plotting(model,
                                              easylca$settings, 
                                              show_significance)
n_indicators <- unique((model_parameters$item)) %>% length()
n_continuous <- model_parameters %>% 
  dplyr::distinct(item, .keep_all = T) %>% 
  dplyr::filter(plotgroup == 'continuous') %>% nrow()
n_binary <- model_parameters %>% 
  dplyr::distinct(item, .keep_all = T) %>% 
  dplyr::filter(plotgroup == 'binary') %>% nrow()
n_discrete <- model_parameters %>% 
  dplyr::distinct(item, .keep_all = T) %>% 
  dplyr::filter(plotgroup == 'discrete') %>% nrow()
```

## Model summary

Type: `r modeltype`\
Classes: `r classes`

N = `r model$summaries$Observations`\
Number of Parameters: `r model$summaries$Parameters`

`r n_continuous` continuous indicators, `r n_binary + n_discrete` discrete indicators (`r n_binary` of these binary)

## Model Entropy

[**`r model$summaries$Entropy`**]{style="font-size: 20pt"}

## Model implicated class sizes

```{r class_sizes, echo=F, fig.height=classes*0.75}
plot_class_prevalences(model)
```

## Mean class assignment probabilities (posterior)

[from high to low mean probability:]{style="color: #737373;"}

```{r assignement_probabilities, echo=F}
create_mean_assignement_probabilities_table(model)
```

## Indicator relevance

```{r, indicator_relevance, echo=F, fig.height=n_indicators*0.65}
plot_kruskal_profiles(model)
```

## Continuous indicators

```{r, continuous_indicators, echo=F, fig.height=ceiling(n_continuous /ifelse(classes > 6, 1, 2))*3 + 0.01}
if(n_continuous > 0){
  plot_continuous_profiles(model_parameters, 
                           show_significance = show_significance)
}
```

```{r no_continuous_indicators, echo=F, results='asis'}
if(n_continuous == 0){cat('There are no continuous indicators.')}
```

## Binary indicators

```{r, binary_indicators, echo=F, fig.height=n_binary *1 + 0.5}
if(n_binary > 0){
  plot_binary_profiles(model_parameters, 
                       show_significance = show_significance)
}
```

```{r no_binary_indicators, echo=F, results='asis'}
if(n_binary == 0){cat('There are no binary indicators.')}
```

## Discrete indicators

```{r, discrete_indicators, echo=F, fig.height=n_discrete * classes * 0.3 + 1}
if(n_discrete > 0){
  plot_discrete_profiles(model_parameters, 
                         show_significance = show_significance)
}
```

```{r no_discrete_indicators, echo=F, results='asis'}
if(n_discrete == 0){cat('There are no discrete indicators with more than 2 levels.')}
```