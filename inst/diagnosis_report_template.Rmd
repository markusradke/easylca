---
title: "*easylca* data diagnosis report for `r params$title`"
date: "*created `r format(Sys.time(), '%H:%M, %B %d, %Y')`*"
output: 
  html_document:
    css: diagnosis_report_template.css
params:
  data: NULL
  idcol: NULL
  title: NULL
---

## Variable Types

```{r types and plot settings, echo=F}
data <- params$data
idcol <- params$idcol
title <- params$title
types <- sapply(dplyr::select(data, -all_of(idcol)), class)
discrete <- types[types == 'integer'] %>% names()
continuous <- types[types == 'numeric'] %>% names()
is_discrete <- length(discrete) > 0
is_continuous <- length(continuous) > 0
continuous_greater_1 <- length(continuous) > 1

n_col_cont_histo <- 2
n_col_dis_histo <- 3
n_row_cont_histo <- ceiling(length(continuous)/n_col_cont_histo)
n_row_dis_histo <- ceiling(length(discrete)/n_col_dis_histo)
```

**N = `r nrow(data)`** observations, id variable is *`r idcol`*.\

**`r length(continuous)` continuous indicators** (type `numeric`):\
*`r continuous`*

**`r length(discrete)` discrete indicators** (type `integer > 1`, max 10 levels):\
*`r discrete`*

## Missings

```{r missings_calc, echo=F}
missings <- get_missings_frequencies(data, idcol)
is_missings <- nrow(missings) > 0
```

```{r missings_plot, echo=F, fig.height=nrow(missings)*0.4+0.75, warning=F}
if(is_missings){
  plot_missings_frequencies(missings)
}
```

```{r missings_no_indicators, echo=F, results='asis'}
if(! is_missings){cat('There are no missing values.')}
```

All other indicators do not have missing values.

## Spearman correlations between continuous indicators

```{r correlations, echo=F, fig.height=length(continuous)*0.5+1.5, fig.width=length(continuous)*0.5+2, warning=F}
if(continuous_greater_1){
  plot_spearman_correlations(data, continuous)
} 
```

```{r correlations_no_indicators, echo=F, results='asis'}
if(!continuous_greater_1){
  cat('There are less than 2 continuous indicators. Thus, no Spearman correlations are computed.')
}
```

## Indicator distributions

#### [Continuous indicators]{style="color: #c40d20"}

```{r continuous_histograms, echo=F, fig.height=n_row_cont_histo*2.5+0.001,  warning=F}
if(length(continuous)>0){
  plot_continuous_histograms(data, continuous, n_col_cont_histo)
}
```

```{r continuous_histograms_no_indicators, echo=F, results='asis'}
if(! is_continuous){cat('There are no continuous indicators.')}
```

#### [Robust variance (IQR) of continuous indicators]{style="color: #c40d20"}

```{r continuous_distribution_parameters, echo=F, fig.height=length(continuous)*0.4+0.75, warning=F}
if(length(continuous)>1){
  plot_continuous_iqrs(data, continuous)
}
```

```{r continuous_distribution_parameters_no_indicators, echo=F, results='asis'}
if(! continuous_greater_1){cat('There are less than 2 continuous indicators. Thus, there is no potential need for scaling.')}
```

#### [Discrete indicators]{style="color: #c40d20"}

```{r discrete_histograms, echo=F, fig.height=n_row_dis_histo * 2.5+0.001,  warning=F}
if(length(discrete)>0){
  plot_discrete_histograms(data, discrete, n_row_dis_histo)
} 
```

```{r discrete_histograms_no_indicators, echo=F, results='asis'}
if(!is_discrete){cat('There are no discrete indicators.')}
```
